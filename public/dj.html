<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Starcup Jukebox Live â€“ DJ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <script src="/socket.io/socket.io.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #210D41;
      color: #fff;
      padding: 20px;
    }
    h1 {
      margin-top: 0;
    }
    button {
      padding: 12px 18px;
      margin: 6px 0;
      font-size: 16px;
      cursor: pointer;
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .box {
      background: #590D7D;
      padding: 15px;
      margin-top: 15px;
      border-radius: 8px;
    }
    .code {
      font-size: 28px;
      font-weight: bold;
      letter-spacing: 3px;
    }
  </style>
</head>
<body>

  <h1>ðŸŽ§ STARCUP JUKEBOX LIVE</h1>
  <p>Lâ€™animation musicale interactive en temps rÃ©el</p>

  <button id="createSessionBtn">CrÃ©er une session</button>
  <button id="openScreenBtn" disabled>Ouvrir Ã©cran vidÃ©oprojecteur</button>

  <div class="box">
    <div>Code session :</div>
    <div class="code" id="roomCode">â€”</div>
  </div>

  <div class="box">
    <button id="openVoteBtn" disabled>Ouvrir un vote</button>
    <button id="validateVoteBtn" disabled>Fermer + valider</button>
  </div>

  <div class="box">
    <strong>Ã‰tat :</strong>
    <span id="statusText">Aucune session</span>
  </div>

<script>
  const socket = io({
    transports: ["websocket"]
  });

  const createSessionBtn = document.getElementById("createSessionBtn");
  const openScreenBtn   = document.getElementById("openScreenBtn");
  const openVoteBtn     = document.getElementById("openVoteBtn");
  const validateVoteBtn = document.getElementById("validateVoteBtn");

  const roomCodeEl = document.getElementById("roomCode");
  const statusText = document.getElementById("statusText");

  let roomCode = null;

  createSessionBtn.addEventListener("click", () => {
    socket.emit("create-room");
  });

  openScreenBtn.addEventListener("click", () => {
    if (!roomCode) return;
    window.open(`/screen.html?room=${roomCode}`, "_blank");
  });

  openVoteBtn.addEventListener("click", () => {
    if (!roomCode) return;
    socket.emit("open-vote", { roomCode });
  });

  validateVoteBtn.addEventListener("click", () => {
    if (!roomCode) return;
    socket.emit("close-vote", { roomCode });
  });

  socket.on("room-created", (code) => {
    roomCode = code;
    roomCodeEl.textContent = code;

    openScreenBtn.disabled = false;
    openVoteBtn.disabled = false;

    statusText.textContent = "Session crÃ©Ã©e â€“ aucun vote en cours";
  });

  socket.on("vote-opened", () => {
    statusText.textContent = "Vote en cours";
    validateVoteBtn.disabled = false;
    openVoteBtn.disabled = true;
  });

  socket.on("vote-closed", () => {
    statusText.textContent = "Vote validÃ©";
    validateVoteBtn.disabled = true;
    openVoteBtn.disabled = false;
  });

</script>

</body>
</html>
